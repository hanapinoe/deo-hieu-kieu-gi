<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tìm kiếm sách tương tự</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 50px;
        }
        label, input, button {
            margin-bottom: 10px;
        }
        .book-card {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .book-card img {
            width: 100px;
            height: 100px;
            margin-right: 20px;
        }
        .book-card h3 {
            margin: 0;
        }
        .book-card p {
            margin: 5px 0 0;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

    <h1>Tìm kiếm sách tương tự</h1>

    <!-- Form để người dùng nhập tên sách và chọn ảnh -->
    <form id="searchForm">
        <label for="bookTitle">Tên sách:</label><br>
        <input type="text" id="bookTitle" name="bookTitle" required><br><br>

        <label for="imageFile">Chọn ảnh:</label><br>
        <input type="file" id="imageFile" name="imageFile" accept="image/*" required><br><br>

        <button type="submit">Tìm kiếm</button>
    </form>

    <h2>Danh sách sách tương tự:</h2>
    <div id="resultContainer"></div>

    <script>
        document.getElementById("searchForm").onsubmit = function(event) {
            event.preventDefault(); // Ngừng hành động gửi form mặc định

            let formData = new FormData();
            let bookTitle = document.getElementById("bookTitle").value;
            let imageFile = document.getElementById("imageFile").files[0];

            formData.append("bookTitle", bookTitle);
            formData.append("imageFile", imageFile);

            // Gửi request POST đến Flask server
            fetch("/search_books", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Xử lý kết quả trả về
                let resultContainer = document.getElementById("resultContainer");
                resultContainer.innerHTML = ""; // Xóa kết quả cũ

                if (data.success && data.books.length > 0) {
                    data.books.forEach(book => {
                        let bookCard = document.createElement("div");
                        bookCard.classList.add("book-card");

                        let bookImage = document.createElement("img");
                        bookImage.src = book.url;  // Đảm bảo sử dụng URL đúng từ Flask

                        let bookInfo = document.createElement("div");

                        let bookTitle = document.createElement("h3");
                        bookTitle.textContent = book.book_title;

                        let bookUrl = document.createElement("p");
                        bookUrl.textContent = `URL ảnh: ${book.url}`;

                        bookInfo.appendChild(bookTitle);
                        bookInfo.appendChild(bookUrl);

                        bookCard.appendChild(bookImage);
                        bookCard.appendChild(bookInfo);

                        resultContainer.appendChild(bookCard);
                    });
                } else {
                    resultContainer.innerHTML = "<p>Không tìm thấy sách tương tự.</p>";
                }
            })
            .catch(error => {
                console.error("Lỗi:", error);
                document.getElementById("resultContainer").innerHTML = "<p>Đã xảy ra lỗi khi tìm kiếm sách.</p>";
            });
        };
    </script>
</body>
</html>
